<div class="max-w-3xl mx-auto p-6">

  <!-- Success and Error Messages -->
  @if (message) {
    <div class="mb-4 p-3 rounded-lg bg-green-100 text-green-700 border border-green-300">
      {{ message }}
    </div>
  }

  <!-- Error Message -->
  @if (error) {
    <div class="mb-4 p-3 rounded-lg bg-red-100 text-red-700 border border-red-300">
      {{ error }}
    </div>
  }

  <h2 class="text-3xl font-semibold mb-6 text-gray-800">Find Booking</h2>

  <!-- Search Section -->
  <div class="bg-white p-6 shadow-md rounded-xl mb-6">
    <div class="space-y-3">
      <input
        type="text"
        placeholder="Enter your booking confirmation code"
        [(ngModel)]="confirmationCode"
        required
        class="w-full p-2 border border-gray-300 rounded-lg
               focus:ring-2 focus:ring-blue-300 focus:outline-none"
      />
      <button 
        (click)="handleSearch()"
        class="w-full bg-blue-600 text-white py-2.5 rounded-lg font-medium
               hover:bg-blue-700 transition shadow"
      >
        Find
      </button>
    </div>
  </div>

  <!-- Booking Details -->
  @if (bookingDetails) {
    <div class="bg-white p-6 shadow-md rounded-xl mb-6 space-y-3">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Booking Details</h3>
      <p class="text-gray-700"><strong class="font-medium">Booking Code:</strong> {{ bookingDetails.bookingReference }}</p>
      <p class="text-gray-700"><strong class="font-medium">Check-in Date:</strong> {{ bookingDetails.checkInDate }}</p>
      <p class="text-gray-700"><strong class="font-medium">Check-out Date:</strong> {{ bookingDetails.checkOutDate }}</p>
      
      <!-- Hi·ªÉn th·ªã gi√° t·∫°i th·ªùi ƒëi·ªÉm booking -->
      <p class="text-gray-700"><strong class="font-medium">Price per Night (at booking):</strong> ${{ bookingDetails.pricePerNightAtBooking }}</p>
      <p class="text-gray-700"><strong class="font-medium">Total Amount:</strong> ${{ bookingDetails.totalPrice }}</p>
      
      <!-- N·∫øu gi√° ph√≤ng hi·ªán t·∫°i kh√°c gi√° l√∫c booking -->
      @if (bookingDetails.room?.pricePerNight !== bookingDetails.pricePerNightAtBooking) {
        <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
          <p class="text-sm text-yellow-800">
            <strong>Note:</strong> Current room price is ${{ bookingDetails.room?.pricePerNight }}/night
          </p>
        </div>
      }
      
      <p class="text-gray-700">
        <strong class="font-medium">Payment Status:</strong> 
        <span [class]="'px-2 py-1 rounded text-sm ml-2 ' + getPaymentStatusClass(bookingDetails.paymentStatus)">
          {{ bookingDetails.paymentStatus }}
        </span>
      </p>
      <p class="text-gray-700">
        <strong class="font-medium">Booking Status:</strong> 
        <span [class]="'px-2 py-1 rounded text-sm ml-2 ' + getBookingStatusClass(bookingDetails.bookingStatus)">
          {{ bookingDetails.bookingStatus }}
        </span>
      </p>
    </div>

    <div class="bg-white p-6 shadow-md rounded-xl mb-6 space-y-3">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Customer Details</h3>
      <p class="text-gray-700"><strong class="font-medium">First Name:</strong> {{ bookingDetails.user.firstName }}</p>
      <p class="text-gray-700"><strong class="font-medium">Last Name:</strong> {{ bookingDetails.user.lastName }}</p>
      <p class="text-gray-700"><strong class="font-medium">Email:</strong> {{ bookingDetails.user.email }}</p>
      <p class="text-gray-700"><strong class="font-medium">Phone Number:</strong> {{ bookingDetails.user.phoneNumber }}</p>
    </div>

    <div class="bg-white p-6 shadow-md rounded-xl mb-6 space-y-3">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Room Details</h3>
      <p class="text-gray-700"><strong class="font-medium">Room Number:</strong> {{ bookingDetails.room.roomNumber }}</p>
      <p class="text-gray-700"><strong class="font-medium">Room Type:</strong> {{ bookingDetails.room.type }}</p>
      <p class="text-gray-700"><strong class="font-medium">Room Capacity:</strong> {{ bookingDetails.room.capacity }}</p>
      <p class="text-gray-700"><strong class="font-medium">Current Price:</strong> ${{ bookingDetails.room.pricePerNight }}/night</p>
      <img 
        [src]="'http://localhost:8080' + bookingDetails.room.imageUrl" 
        alt="Room Image"
        class="w-full max-h-64 object-cover rounded-lg shadow mt-3"
      />
    </div>

    <!-- Guest Information -->
    @if (bookingDetails && bookingDetails.guests && bookingDetails.guests.length > 0) {
      <div class="bg-white p-6 shadow-md rounded-xl mb-6 space-y-3">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Guest Information</h3>
        @for (guest of bookingDetails.guests; track guest.id; let i = $index) {
          <div class="border-b border-gray-200 pb-3 last:border-0 last:pb-0">
            <p class="text-gray-700 font-medium">Guest {{ i + 1 }}</p>
            <p class="text-gray-600 text-sm">{{ guest.firstName }} {{ guest.lastName }}</p>
            <p class="text-gray-600 text-sm">{{ guest.email }} | {{ guest.phoneNumber }}</p>
            @if (guest.identityNumber) {
              <p class="text-gray-600 text-sm">ID: {{ guest.identityNumber }}</p>
            }
          </div>
        }
      </div>
    }

    <!-- Cancel Booking Section -->
    <div class="bg-white p-6 shadow-md rounded-xl space-y-3">
      <!-- Warning v·ªÅ cancellation policy -->
      @if (canCancelBooking()) {
        <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800">
          <p class="font-medium mb-1">üìã Cancellation Policy:</p>
          <ul class="list-disc list-inside text-xs space-y-1">
            <li>Must cancel at least 24 hours before check-in</li>
            <li>Cannot cancel after check-in date</li>
            <li>Full refund for paid bookings</li>
          </ul>
        </div>
        
        <button 
          (click)="handleCancelBooking()"
          class="w-full bg-red-600 text-white py-2.5 rounded-lg font-medium
                 hover:bg-red-700 transition shadow"
        >
          Cancel Booking
        </button>
      } @else {
        <div class="p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700">
          <p class="font-medium">‚ùå This booking cannot be cancelled</p>
          <p class="text-xs mt-1">Reason: {{ getCancellationReason() }}</p>
        </div>
      }
    </div>
  }
</div>